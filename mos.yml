author: Your Name
description: Coin counter example for Mongoose OS
version: 1.0

manifest_version: 2017-05-18

libs_version: ${mos.version}
modules_version: ${mos.version}
mongoose_os_version: ${mos.version}

sources:
  - src

filesystem:
  - fs

libs:
  #- origin: https://github.com/mongoose-os-libs/boards
  #- origin: https://github.com/mongoose-os-libs/js-demo-bundle
  - origin: https://github.com/mongoose-os-libs/core
  - origin: https://github.com/mongoose-os-libs/ca-bundle
  - origin: https://github.com/mongoose-os-libs/rpc-service-config
  - origin: https://github.com/mongoose-os-libs/rpc-service-fs
  - origin: https://github.com/mongoose-os-libs/rpc-service-i2c
  - origin: https://github.com/mongoose-os-libs/rpc-uart
  - origin: https://github.com/mongoose-os-libs/rpc-service-gpio
  #- origin: https://github.com/mongoose-os-libs/mjs 
  - origin: https://github.com/mongoose-os-libs/wifi
  - origin: https://github.com/mongoose-os-libs/sntp
  #- origin: https://github.com/mongoose-os-libs/ota-http-server
  - origin: https://github.com/mongoose-os-libs/rpc-service-ota
  - origin: https://github.com/mongoose-os-libs/dash
  #- origin: https://github.com/mongoose-os-libs/shadow
  - origin: https://github.com/mongoose-os-libs/file-logger
  - origin: https://github.com/mongoose-os-libs/i2c
  - origin: https://github.com/mongoose-os-libs/ds3231
  - origin: https://github.com/mongoose-os-libs/mqtt
  - origin: https://github.com/mongoose-os-libs/rpc-mqtt


build_vars:
  COIN_PIN: 26
  COIN_COUNT_FILE: '"/counters.json"'
  COIN_REPORT_DELAY: 5000

config_schema:
  - ["app.total_bag", "d", 0.0, {title: "Total bag count"}]
  - ["app.total_gift", "d", 0.0, {title: "Total gift count"}]
  - ["app.machine_id", "s", "M-E2-EA-MUEE-0", {title: "Machine ID"}]
  - ["wifi.sta.ssid", "s", "Inventoteca_2G", {title: "SSID"}]
  - ["wifi.sta.pass", "s", "science_7425", {title: "Password"}]
  - ["wifi.sta.enable", "b", true, {title: "Enable WiFi"}]
  - ["sys.mount.fs_size", "i", 2048, {title: "Filesystem size in KB"}]

  - ["coin_pin", "i", 26, {title: "Coin pin"}]
  - ["gift_pin", "i", 25, {title: "Gift pin"}]
  - ["pin_machine", "i", 4, {title: "Pin to control relay machine"}]
  - ["status_pin", "i", 33, {title: "Pin to read machine status"}]
  - ["machine_on", "b", false, {title: "Machine on status"}]

  - ["coin.count_file", "s", "/counters.json", {title: "Coin count file"}]
  - ["coin.report_delay", "i", 5000, {title: "Coin report delay in ms"}]

  - ["dash.enable", "b", true, {title: "Enable mDash"}]
  - ["dash.token", "s", "4n8KckV1Ih99NrK7QTmZA91w", {title: "mDash token"}]
  - ["rpc.uart.enable", "b", true, {title: "Enable UART for RPC"}]

  - ["mqtt.enable", "b", true, {title: "Enable MQTT"}]
  - ["mqtt.server", "s", "broker.emqx.io:1883", {title: "MQTT Server"}]
  - ["rpc.mqtt.enable", "b", true, {title: "Enable RPC over MQTT"}]


ffi_symbols:
  - pcnt_unit_config
  - pcnt_counter_pause
  - pcnt_counter_resume
  - pcnt_counter_clear
  - pcnt_get_counter_value
  - pcnt_event_enable
  - pcnt_event_disable
  - pcnt_isr_service_install
  - pcnt_isr_handler_add
  - pcnt_isr_handler_remove
  - pcnt_set_event_value
  - pcnt_set_filter_value
